SET QUOTED_IDENTIFIER, ANSI_NULLS ON
GO
CREATE   VIEW [dbo].[INAT_VW_BASE_REQUISIÇÕES_SENIOR] 
AS SELECT 

CONCAT_WS('-','MIB',E207RAT.CODEMP,E207RAT.CODCCU)  'KEY CR SENIOR',
UPPER(E044CCU.DESCCU) 'CENTRO DE RESULTADO',
CAST(E207EME.DATEME AS DATE) 'DATA',
E044CCU.CODCCU 'COD CR',
SUM(E207RAT.QTDRAT) '#VALOR'



FROM Sapiens.Sapiens.E207RAT WITH (NOLOCK)

JOIN Sapiens.Sapiens.E207EME WITH (NOLOCK)
  ON E207RAT.CODEMP = E207EME.CODEMP
  AND E207RAT.NUMEME = E207EME.NUMEME
  AND E207RAT.SEQEME = E207EME.SEQEME

JOIN Sapiens.Sapiens.E044CCU WITH (NOLOCK)
  ON E207RAT.CODEMP = E044CCU.CODEMP
  AND E207RAT.CODCCU = E044CCU.CODCCU

WHERE E207EME.USU_IDEEMP = 'MIB'
AND CAST(E207EME.DATEME AS DATE) >= '01/01/2023' 
--AND CAST(E207EME.DATEME AS DATE) <= '31/12/2023' 
 -- E207EME.CODPRO = '02370001' AND

GROUP BY
E207RAT.CODEMP,
E207RAT.CODCCU,
E044CCU.DESCCU,
CAST(E207EME.DATEME AS DATE),
E044CCU.CODCCU

UNION ALL


SELECT 

CONCAT_WS('-','MML',E207RAT.CODEMP,E207RAT.CODCCU)  'KEY CR SENIOR',
UPPER(E044CCU.DESCCU) 'CENTRO DE RESULTADO',
CAST(E207EME.DATEME AS DATE) 'DATA',
E044CCU.CODCCU 'COD CR',
SUM(E207RAT.QTDRAT) '#VALOR'



FROM [SQLMML].[Sapiens_Prod].[dbo].[E207RAT] WITH (NOLOCK)

JOIN [SQLMML].[Sapiens_Prod].[dbo].[E207EME] WITH (NOLOCK)
  ON E207RAT.CODEMP = E207EME.CODEMP
  AND E207RAT.NUMEME = E207EME.NUMEME
  AND E207RAT.SEQEME = E207EME.SEQEME

JOIN [SQLMML].[Sapiens_Prod].[dbo].[E044CCU] WITH (NOLOCK)
  ON E207RAT.CODEMP = E044CCU.CODEMP
  AND E207RAT.CODCCU = E044CCU.CODCCU

WHERE E207RAT.CODEMP = 1
AND  CAST(E207EME.DATEME AS DATE) >= '01/01/2023' 



GROUP BY
E207RAT.CODEMP,
E207RAT.CODCCU,
E044CCU.DESCCU,
CAST(E207EME.DATEME AS DATE),
E044CCU.CODCCU
--AND  CAST(E207EME.DATEME AS DATE) <= '31/12/2023' 


--SELECT DISTINCT USU_IDEEMP  FROM [SQLMML].[Sapiens_Prod].[dbo].[E207EME] WITH (NOLOCK)
GO