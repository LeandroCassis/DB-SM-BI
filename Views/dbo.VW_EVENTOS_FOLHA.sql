SET QUOTED_IDENTIFIER, ANSI_NULLS ON
GO
CREATE   VIEW [dbo].[VW_EVENTOS_FOLHA] 
AS SELECT

  USU_V001FIC.Empresa 'COD EMPRESA'
 ,USU_V001FIC.Tipo_Empregado 'COD TIPO EMPREGADO'
 ,USU_V001FIC.Matricula 'MATRÍCULA'
 ,CAST(USU_V001FIC.Competencia AS DATE) 'DATA'
 ,r034fun.numloc 'COD LOCAL'
 ,UPPER(R016ORN.nomloc) 'LOCAL'
 ,USU_V001FIC.Codigo_Evento  'COD EVENTO'
 ,UPPER(USU_V001FIC.Descricao_Evento) 'EVENTO'
 ,EVENTOS_FOLHA_CONSIDERADOS.[GRUPO EVENTO]
 ,SUM(USU_V001FIC.Valor) '#VALOR'

FROM Vetorh.Vetorh.USU_V001FIC WITH (NOLOCK)

LEFT JOIN Vetorh.Vetorh.R034FUN WITH (NOLOCK)
ON USU_V001FIC.Empresa = R034FUN.NUMEMP
AND USU_V001FIC.Matricula = R034FUN.NUMCAD

LEFT JOIN VETORH.VETORH.R016ORN WITH (NOLOCK)
ON r034fun.taborg = r016orn.taborg 
AND r034fun.numloc = r016orn.numloc

INNER JOIN  EVENTOS_FOLHA_CONSIDERADOS WITH (NOLOCK)
ON USU_V001FIC.Codigo_Evento = EVENTOS_FOLHA_CONSIDERADOS.[COD EVENTO]

WHERE YEAR(USU_V001FIC.Competencia) >= 2024
AND R034FUN.NUMLOC IN (7,18,19,44,42,62,163,170,117,123,131,132)
--AND CAST(USU_V001FIC.Competencia AS DATE) = '01/01/2024'
--AND USU_V001FIC.Matricula = 3
--AND USU_V001FIC.Empresa = 2

GROUP BY 
 USU_V001FIC.Empresa
,USU_V001FIC.Tipo_Empregado 
,USU_V001FIC.Matricula 
,CAST(USU_V001FIC.Competencia AS DATE) 
,USU_V001FIC.Codigo_Evento 
,UPPER(USU_V001FIC.Descricao_Evento) 
,EVENTOS_FOLHA_CONSIDERADOS.[GRUPO EVENTO]
,r034fun.numloc  
,R016ORN.nomloc
GO